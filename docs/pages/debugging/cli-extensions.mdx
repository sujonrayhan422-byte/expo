---
title: Expo CLI Extensions
sidebar_title: Expo CLI Extensions
description: Learn about using cli extension plugins in your Expo packages.
---

import { PaddedAPIBox } from '~/components/plugins/PaddedAPIBox';

Expo CLI extensions are plugins distributed as npm packages that add features to the Expo CLIâ€”such as inspecting or debugging your project.

Each extension is a Node.js app defined in the **expo-modules.config.json** file of your package.

The `expo/devtools` package provides APIs to enable communication between CLI extensions and running Expo apps.

## Creating a CLI extension

You can create your CLI extension by following these steps:

- Declare your CLI extension in the **expo-modules.config.json** file of your package.
- Implement the CLI extension app under the cli directory of your package.
- Use the `expo/devtools` API to communicate between your CLI extension and running Expo apps.

### Declaring your CLI extension

To declare your CLI extension, add an entry to the **cli** array in the **expo-modules.config.json** file of your package:

```json
{
  "platforms": [ "apple", "android", "devtools" ],
  ...
  "devtools": {
    "cliExtensions": {
      "description": "Expo: manage background tasks",
      "commands": [
        { "name": "list", "title": "List registered background tasks", "environments": [ "cli"] },
        { "name": "trigger-test", "title": "Trigger background tasks", "environments": [ "cli" ] }
      ],
      "entryPoint": "cli/build/index.js"
    }
  }
}
```

### Implementing your CLI extension

Create a `cli` directory in the root of your package, and implement your CLI extension app in that directory. The entry point of your CLI extension app should match the `entryPoint` field you specified in the **expo-modules.config.json** file.

### Using the `expo/devtools` API

You can use the `expo/devtools` API to communicate between your CLI extension and running Expo apps.

<PaddedAPIBox header="runCliExtension">

The simplest way to get started is to use the `runCliExtension` function in your CLI extension app:

```ts
import { runCliExtension } from '@expo/devtools';

runCliExtension<{
  list: Record<string, never>;
}>(async ({ command }, console) => {
  console.log(`Running command: ${command}`);
});
```

</PaddedAPIBox>

> **Note:** The `expo/devtools` package re-exports `@expo/devtools`. CLI extensions (which run in a Node.js context) should import directly from `@expo/devtools`, while app-side code should use `expo/devtools`.

### Add communication between your CLI extension and your Expo app

To add communication between your CLI extension and your Expo app, you can use the `sendCliMessageAsync` function from the `expo/devtools` package. This function allows you to send messages from your CLI extension to the running Expo app and receive responses.

```ts
import { runCliExtension, sendCliMessageAsync, queryAllInspectorAppsAsync } from '@expo/devtools';

const PLUGIN_NAME = 'expo-background-task';
const GET_REGISTERED_TASKS = 'get-registered-tasks';

runCliExtension<{
  list: Record<string, never>;
}>(async ({ command, metroServerOrigin }, console) => {
  // Query connected apps
  const apps = await queryAllInspectorAppsAsync(metroServerOrigin);
  if (apps.length === 0) {
    console.error(`No connected apps found at ${metroServerOrigin}`);
    return;
  }

  if (command === 'list') {
    try {
      // Send message to the app
      const response = await sendCliMessageAsync(GET_REGISTERED_TASKS, PLUGIN_NAME, apps);
      // Handle response from the running apps (there may be multiple)
      Object.keys(response).forEach(appId => {
        const app = apps.find(a => a.id === appId);
        console.info(`${chalk.blue(app?.title ?? appId)}: ${response[appId] ?? ''}`);
      });
    } catch (error) {
      // Catch and rethrow error with more context
      throw new Error('An error occured connecting to the app.', { cause: error });
    }
  }
});
```

### Handling CLI messages in your app

To receive and respond to messages from your CLI extension, use the `startCliListenerAsync` function in your app code:

```ts
import { startCliListenerAsync } from 'expo/devtools';

const PLUGIN_NAME = 'expo-background-task';
const GET_REGISTERED_TASKS = 'get-registered-tasks';

startCliListenerAsync(PLUGIN_NAME)
  .then(({ addMessageListener }) => {
    addMessageListener(GET_REGISTERED_TASKS, async ({ sendResponseAsync }) => {
      // Perform your logic here
      const result = 'Your response message';
      await sendResponseAsync(result);
    });
  })
  .catch(error => {
    console.error('Failed to start CLI listener:', error);
  });
```

> **Note:** The `startCliListenerAsync` function only runs in development mode (`__DEV__ === true`). Make sure the `PLUGIN_NAME` matches between your CLI extension and app-side listener.

## Testing your CLI extension

You can test your CLI extension by following these steps:

- Restart your Expo CLI to load the new extension
- Reload your app
- Test your CLI extension by pressing the `shift` + `m` keys in the Expo CLI to bring up the CLI devtools menu

## Exposing your extension to the Expo MCP server

If you'd like your CLI extension to be discoverable by the [Expo MCP](/eas/ai/mcp/) server, you can add the `mcp` value to the `environments` field to your package's **expo-modules.config.json** file.
This will allow users to find and install your CLI extension using the Expo CLI.

_The Expo MCP server is an experimental feature and is subject to change._
